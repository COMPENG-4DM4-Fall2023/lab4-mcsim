My own Steps: (rmirosan@uwaterloo.ca)


1- Download the latest macsim and build
2- Download the PIN 3.13 from https://software.intel.com/content/www/us/en/develop/articles/pin-a-binary-instrumentation-tool-downloads.html
3- move it to the $x86_trace_generator
4- move libzlib.a to /extra/xed-intel64/lib/
5- go to source/tools and make
6- if you see error like gcc-3.4 cannot be found, play with your export and the version of gcc/g++/cpp. I have checked the 7.5.0 works with macsim and the last step of trace generator but you might need 4.8 for this step
7- change the makefile of trace generator as follows:

CONFIG_ROOT := $(PIN_ROOT)/source/tools/Config




include $(CONFIG_ROOT)/makefile.config

include makefile.rules

include $(TOOLS_ROOT)/Config/makefile.default.rules

 
8- make the bashrc script variables as follows:
 
export PIN_HOME=/home/rmirosan/MCSIMULATOR/original_macsim/macsim-from-git-PIN/tools/x86_trace_generator/pin-3.13-98189-g60a6ef199-gcc-linux
export PATH=$PIN_HOME:$PATH
export PIN_ROOT=$PIN_HOME
9- now, make the trace generator
10- go to the PIN directory and you can now run with:

 ./pin -t ../obj-intel64/trace_generator.so -- ../hello_world/out_bin  -i X -a READ/WRITE or any argument

Now if you want to just capture specific section of the code do the following:

1- add the following before main:


unsigned __attribute__ ((noinline)) SIM_BEGIN(bool
i)

{

if (i==false) return 0;

printf("sim begin\n");

return 1;

}

unsigned __attribute__ ((noinline)) SIM_END(bool
i)

{

if (i==false) return 0;

printf("sim end\n");

return 1;

} 


2- add

#include <stdbool.h>

 
3- add

SIM_BEGIN(1);

before the section and
 
 

SIM_END(1);

after the section.
 

4- Finally run the pin with the following: 
 ./pin -t ../obj-intel64/trace_generator.so -manual 1 -thread 1  -- ../hello_world/out_bin -i iteration -i access (if bandwidth)







/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////









Please use Pin 3.13  (version number 56759) for the current trace generator 

How to generate x86 traces
  1. do make (copy libzlib.a in the location )
 (optional)
  1. Simpoint - Mostly we use SimPoint (PinPoint). Follow instruction
     in $PINHOME/source/tools/PinPoints

  2. Otherwise - Fix trace generator module based on your needs. Then,
     pin -t trace_generator.so -- $BIN $ARGS

     [1] Install Pin  (https://software.intel.com/content/www/us/en/develop/articles/pin-a-dynamic-binary-instrumentation-tool.html) 
     [2] go to macsim/tools/x86_trace_generator directory 
     [3] set up $PIN_ROOT the root directory of pin  and copy libzilb.a in  
     [4] make 
     [5] pin -t obj-intel64/trace_generator.so - $BIN $ARGS 



Note

  1. As the pin version changes, we need to consider few things.
     Ideally, everything should be okay, but sometime there are
     changes in the xed files (especially opcode or instruction
     category). In this case, we need to update few fields in the
     pintool as well as the simulator.

     1) Sanity check will be failed if there are changes.

     2) The compilation might be failed as well.

     Once fixing pintool, also some simulator logic needs to be modified.

     Simulator
       trace_read.h : 

         1) enum TR_OPCODE_ENUM

       trace_read.cc :
     
         1) init_pin_convert
         2) g_tr_reg_name
         3) g_tr_opcode_names
     

Known Problems

  1. pin-2.10-41150-gcc.3.4.6-ia32_intel64-linux/pin: line 52: pin-2.10-41150-gcc.3.4.6-ia32_intel64-linux/ia32/bin/pinbin: No such file or directory 
 
     This happens due to missing ia32 libraries. Please install ia32-libs.   
     
     => apt-get install ia32-libs

Changes

  1. November 2011 

    Register compression logic is replace by REG_FullRegName, which
    translate partial register to full register.



